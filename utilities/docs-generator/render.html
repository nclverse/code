<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Namespaces</title>
<link href="http://fonts.googleapis.com/css?family=Fira+Sans:300,400,500,700|Inconsolata" rel="stylesheet" type="text/css" />

    <link href="http://nclverse.github.io/code/css/styles.css" media="all" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <section id="container">
      <section id="sidebar"><nav id="main-nav">
  <header id="title">
    <img class="site-logo" alt="logo" src="http://nclverse.github.io/code/img/logo.svg" />
    <div class="titles">
      <span class="verse-title">NCL<strong>Verse</strong></span>
      <ul class="docs-site">
        <li><a class="active" href="http://nclverse.github.io/code">Code</a></li><li><a href="http://nclverse.github.io/dissertation">Dissertation</a></li><li><a href="http://nclverse.github.io/design">Design</a></li><li><a href="http://nclverse.github.io/help">Help</a></li>
      </ul>
    </div>
  </header>
  <div class="category">
    <header class="category-title"><h1>apps<span class="count">234 LOC</span></h1></header>
    <ul class="titles">
      <li><a class="title-link">Architecture<span class="count">0 LOC</span></a>
        <ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/architecture/core-ideas.html">Core Ideas<span class="count">0</span></a></li></ul>
      </li>
      </ul><ul class="titles">
      <li><a class="title-link">Exams<span class="count">234 LOC</span></a>
        <ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/exams/leechness.html">Leechness<span class="count">24</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/exams/gateway.html">Gateway<span class="count">56</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/exams/handler.html">Handler<span class="count">18</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/exams/home.html">Home<span class="count">56</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/exams/layout.html">Layout<span class="count">39</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/apps/exams/transforms.html">Transforms<span class="count">41</span></a></li></ul>
      </li>
      </ul>
  </div><div class="category">
    <header class="category-title"><h1>utilities<span class="count">269 LOC</span></h1></header>
    <ul class="titles">
      <li><a class="title-link active">Docs Generator<span class="count">269 LOC</span></a>
        <ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/utilities/docs-generator/architecture.html">Architecture<span class="count">0</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/utilities/docs-generator/overview.html">Overview<span class="count">0</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/utilities/docs-generator/collect.html">Collect<span class="count">48</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/utilities/docs-generator/transform.html">Transform<span class="count">95</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link active" href="http://nclverse.github.io/code/utilities/docs-generator/render.html">Render<span class="count">126</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/utilities/docs-generator/roadmap.html">Roadmap<span class="count">0</span></a></li></ul>
      </li>
      </ul>
  </div><div class="category">
    <header class="category-title"><h1>tests<span class="count">95 LOC</span></h1></header>
    <ul class="titles">
      <li><a class="title-link">Docs Generator<span class="count">95 LOC</span></a>
        <ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/tests/docs-generator/collect.html">Collect<span class="count">45</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/tests/docs-generator/transform.html">Transform<span class="count">20</span></a></li></ul><ul class="subtitles"><li> <a class="subtitle-link" href="http://nclverse.github.io/code/tests/docs-generator/render.html">Render<span class="count">30</span></a></li></ul>
      </li>
      </ul>
  </div>

</nav></section>
      <section id="read-area"><article class="post">
  <section class="content">
<div id="outline-container-sec-1" class="outline-1">
<h1 id="sec-1">Namespaces</h1>
<div class="outline-text-1" id="text-1">
<p>
Usage of namespaces:
</p>

<p>
Stasis: collecting directories and files.
Ring middleware: Serving the correct content type.
Prone Debug: Debugging Clojure code in the browser.
Java Shell: Running Emacs to convert org files to HTML.
Enlive: Metadata collection.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">docs-gen.render</span>
  <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">stasis.core</span> <span class="ss">:as</span> <span class="nv">stasis</span><span class="p">]</span>
	    <span class="p">[</span><span class="nv">ring.middleware.content-type</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">wrap-content-type</span><span class="p">]]</span>
	    <span class="p">[</span><span class="nv">clojure.java.shell</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">sh</span><span class="p">]]</span>
	    <span class="p">[</span><span class="nv">clojure.java.io</span> <span class="ss">:as</span> <span class="nv">io</span><span class="p">]</span>
	    <span class="p">[</span><span class="nv">prone.debug</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">debug</span><span class="p">]]</span>
	    <span class="p">[</span><span class="nv">docs-gen.collect</span> <span class="ss">:as</span> <span class="nv">collect</span><span class="p">]</span>
	    <span class="p">[</span><span class="nv">docs-gen.transform</span> <span class="ss">:as</span> <span class="nv">transform</span><span class="p">])</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="p">[</span><span class="nv">net.cgrand.enlive-html</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-1">
<h1 id="sec-2">Collector functions</h1>
<div class="outline-text-1" id="text-2">
<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">back-one-directory</span> <span class="p">[</span><span class="nv">s</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">idx</span> <span class="p">(</span><span class="nf">.lastIndexOf</span> <span class="nv">s</span> <span class="s">"/"</span><span class="p">)]</span>
    <span class="p">(</span><span class="nb">subs </span><span class="nv">s</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">idx</span> <span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">collect-vals</span> <span class="p">[</span><span class="nb">key </span><span class="nv">config</span><span class="p">]</span> 
<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">vals </span><span class="p">(</span><span class="nb">map key </span><span class="p">(</span><span class="ss">:sites</span> <span class="nv">config</span><span class="p">))]</span>
<span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">every? </span><span class="p">(</span><span class="nb">complement </span><span class="nv">nil?</span><span class="p">)</span> <span class="nv">vals</span><span class="p">)</span> <span class="nv">vals</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-1">
<h1 id="sec-3">Configuration</h1>
<div class="outline-text-1" id="text-3">
<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="k">def </span><span class="nv">root-dir</span> <span class="p">(</span><span class="nf">back-one-directory</span> <span class="p">(</span><span class="nf">System/getProperty</span> <span class="s">"user.dir"</span><span class="p">)))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">code</span>
<span class="p">{</span><span class="ss">:site</span> <span class="s">"code"</span>
<span class="ss">:metadata</span> <span class="p">[</span><span class="ss">:loc</span><span class="p">]</span>
<span class="ss">:source</span> <span class="p">(</span><span class="nb">str </span><span class="nv">root-dir</span> <span class="s">"code/source"</span><span class="p">)})</span>


<span class="p">(</span><span class="k">def </span><span class="nv">dissertation</span>
<span class="p">{</span><span class="ss">:site</span> <span class="s">"dissertation"</span>
<span class="ss">:metadata</span> <span class="p">[</span><span class="ss">:words</span><span class="p">]</span>
<span class="ss">:source</span> <span class="p">(</span><span class="nb">str </span><span class="nv">root-dir</span> <span class="s">"dissertation/source"</span><span class="p">)})</span>

<span class="p">(</span><span class="k">def </span><span class="nv">design</span>
<span class="p">{</span><span class="ss">:site</span> <span class="s">"design"</span>
<span class="ss">:metadata</span> <span class="p">[]</span>
<span class="ss">:source</span> <span class="p">(</span><span class="nb">str </span><span class="nv">root-dir</span> <span class="s">"design/source"</span><span class="p">)})</span>

<span class="p">(</span><span class="k">def </span><span class="nv">help</span>
<span class="p">{</span><span class="ss">:site</span> <span class="s">"help"</span>
<span class="ss">:metadata</span> <span class="p">[]</span>
<span class="ss">:source</span> <span class="p">(</span><span class="nb">str </span><span class="nv">root-dir</span> <span class="s">"help/source"</span><span class="p">)})</span>

<span class="p">(</span><span class="k">def </span><span class="nv">sites</span> <span class="p">[</span><span class="nv">code</span> <span class="nv">dissertation</span> <span class="nv">design</span> <span class="nv">help</span><span class="p">])</span>

<span class="p">(</span><span class="k">def </span><span class="nv">config</span> <span class="p">{</span>
<span class="ss">:mode</span> <span class="ss">:serve</span> <span class="c1">;:export</span>
<span class="ss">:render-mode</span> <span class="ss">:full</span>
<span class="ss">:serve</span> <span class="p">{</span><span class="ss">:root</span> <span class="s">"http://localhost:3000"</span><span class="p">}</span>
<span class="ss">:export</span> <span class="p">{</span><span class="ss">:root</span> <span class="s">"http://nclverse.github.io"</span><span class="p">}</span>
 <span class="ss">:output</span> <span class="s">"/Users/Prabros/Dropbox/ncl/stage3/clojure/apps"</span>
<span class="ss">:sites</span> <span class="nv">sites</span><span class="p">})</span>
</pre></div>

</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-1">
<h1 id="sec-4">URL Helpers</h1>
<div class="outline-text-1" id="text-4">
<p>
Replaces .org with given string
</p>
</div>
</div>

<div id="outline-container-sec-5" class="outline-1">
<h1 id="sec-5">Org Converter</h1>
<div class="outline-text-1" id="text-5">
<p>
We convert each org page to HTML using Emacs.
</p>
</div>

<div id="outline-container-sec-5-0-1" class="outline-3">
<h3 id="sec-5-0-1">Org to HTML</h3>
<div class="outline-text-3" id="text-5-0-1">
<p>
This uses a script stored inside the resources directory to
convert org file to HTML using the config options specified per
file. Need to decide if a global org file config makes sense.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">org-&gt;html</span> <span class="p">[</span><span class="nv">org-content</span><span class="p">]</span>
<span class="s">"Prerequisite: Emacs with Org-Mode installed.</span>
<span class="s">Converts given org file to html."</span>
<span class="p">(</span><span class="ss">:out</span> <span class="p">(</span><span class="nf">sh</span> <span class="s">"emacs"</span> <span class="s">"--script"</span> <span class="s">"resources/scripts/org-to-html.el"</span> <span class="nv">org-content</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-1">
<h1 id="sec-6">Metadata Collection Helpers</h1>
<div class="outline-text-1" id="text-6">
</div><div id="outline-container-sec-6-0-1" class="outline-3">
<h3 id="sec-6-0-1">Word Count</h3>
<div class="outline-text-3" id="text-6-0-1">
<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">word-count</span> <span class="p">[</span><span class="nv">entry</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">nodes</span> <span class="p">(</span><span class="nf">select-nodes*</span> <span class="p">(</span><span class="nf">html-snippet</span> <span class="nv">entry</span><span class="p">)</span> <span class="p">[</span><span class="nv">text-node</span><span class="p">])</span>
   <span class="nv">text</span> <span class="p">(</span><span class="nb">apply str </span><span class="nv">nodes</span><span class="p">)]</span>
   <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">re-seq </span><span class="o">#</span><span class="s">"\w+"</span> <span class="p">(</span><span class="nf">.toLowerCase</span> <span class="nv">text</span><span class="p">)))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">loc</span> <span class="p">[</span><span class="nv">entry</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">nodes</span> <span class="p">(</span><span class="nf">select-nodes*</span> <span class="p">(</span><span class="nb">select </span><span class="p">(</span><span class="nf">html-snippet</span> <span class="nv">entry</span><span class="p">)</span> <span class="p">[</span><span class="ss">:pre</span><span class="p">])</span> <span class="p">[</span><span class="nv">text-node</span><span class="p">])</span>
   <span class="nv">text</span> <span class="p">(</span><span class="nb">apply str </span><span class="nv">nodes</span><span class="p">)]</span>
   <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">re-seq </span><span class="o">#</span><span class="s">"\n"</span> <span class="nv">text</span><span class="p">))))</span>
</pre></div>

</div>

<p>
#+ATTR<sub>HTML</sub> :class smell
</p>
</div>
</div>
<div id="outline-container-sec-6-0-2" class="outline-3">
<h3 id="sec-6-0-2">URL Components</h3>
<div class="outline-text-3" id="text-6-0-2">
<p>
Pretty contrived right now but supports all the current
documentation sites. Better to make this support. Need to
change this to support arbitrary amount of nesting. 5 seems like
a good limit if arbitrary nesting is a bad idea. Need to reflect
on this problem further.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">url-components</span> <span class="p">[</span><span class="nv">url</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">zipmap </span><span class="p">[</span><span class="ss">:category</span> <span class="ss">:title</span> <span class="ss">:subtitle</span><span class="p">]</span> <span class="p">(</span><span class="nb">filter </span><span class="nv">not-empty</span> <span class="p">(</span><span class="nf">clojure.string/split</span> <span class="nv">url</span> <span class="o">#</span><span class="s">"/"</span><span class="p">))))</span>
</pre></div>

</div>
</div>
</div>

<div id="outline-container-sec-6-0-3" class="outline-3">
<h3 id="sec-6-0-3">Find Title</h3>
<div class="outline-text-3" id="text-6-0-3">
<p>
Gets the title of the converted HTML page.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">title</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">first</span>
   <span class="p">(</span><span class="nf">select</span>
   <span class="p">(</span><span class="nf">html-snippet</span> <span class="nv">x</span><span class="p">)</span> <span class="p">[</span><span class="ss">:h1</span> <span class="nv">text-node</span><span class="p">])))</span>
</pre></div>

</div>
</div>
</div>



<div id="outline-container-sec-6-0-4" class="outline-3">
<h3 id="sec-6-0-4">Meta data function map</h3>
<div class="outline-text-3" id="text-6-0-4">
<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">metadata-fn</span> <span class="p">[</span><span class="nv">k</span><span class="p">]</span>
<span class="p">(</span><span class="nf">letfn</span> <span class="p">[(</span><span class="nf">not-found</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="s">"No such metadata collector exists"</span><span class="p">)]</span>
<span class="p">(</span><span class="nb">or </span><span class="p">({</span><span class="ss">:loc</span> <span class="nv">loc</span>
     <span class="ss">:words</span> <span class="nv">word-count</span><span class="p">}</span> <span class="nv">k</span><span class="p">)</span> <span class="nv">not-found</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>

<div id="outline-container-sec-6-0-5" class="outline-3">
<h3 id="sec-6-0-5">Weave metadata</h3>
<div class="outline-text-3" id="text-6-0-5">
<p>
Collects metadata of each given function.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">weave-meta-data</span> <span class="p">[</span><span class="nv">metadata</span> <span class="nv">html-page</span><span class="p">]</span>
  <span class="p">{</span><span class="ss">:pre</span> <span class="p">[(</span><span class="nb">vector? </span><span class="nv">metadata</span><span class="p">)]</span> <span class="ss">:post</span> <span class="p">[</span><span class="o">#</span><span class="p">(</span><span class="nb">map? </span><span class="nv">%</span><span class="p">)]}</span>
  <span class="p">(</span><span class="nb">zipmap </span><span class="nv">metadata</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">((</span><span class="nf">metadata-fn</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">html-page</span><span class="p">)</span> <span class="nv">metadata</span><span class="p">)))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">nav-element</span> <span class="p">[</span><span class="nv">metadata</span> <span class="nv">url</span> <span class="nv">page</span><span class="p">]</span>
<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">components</span> <span class="p">(</span><span class="nf">url-components</span> <span class="nv">url</span><span class="p">)</span>
<span class="nv">meta-coll</span> <span class="p">(</span><span class="nf">weave-meta-data</span> <span class="nv">metadata</span> <span class="nv">page</span><span class="p">)]</span>
<span class="p">(</span><span class="nb">into </span><span class="nv">components</span> <span class="nv">meta-coll</span><span class="p">)))</span>
</pre></div>

</div>

<p>
Collect metadata from HTML pages
Creates a map of the form:
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">structure-page</span> <span class="p">[</span><span class="nv">url</span> <span class="nv">page</span><span class="p">]</span> <span class="p">{</span><span class="ss">:page</span> <span class="nv">page</span> <span class="ss">:url</span> <span class="p">(</span><span class="nf">url-components</span> <span class="nv">url</span><span class="p">)</span> <span class="ss">:meta</span> <span class="p">{</span><span class="ss">:title</span> <span class="p">(</span><span class="nf">title</span> <span class="nv">page</span><span class="p">)}})</span>
</pre></div>

</div>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-1">
<h1 id="sec-7">Renderers</h1>
<div class="outline-text-1" id="text-7">
<p>
Recombining the pages that have been transformed and rendering them.
Comes in two flavours. One with meta data collection (involves
expensive computation, slows down the generator considerably) and one
without(quick).
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">quick-render</span> <span class="p">[</span><span class="nb">root </span><span class="nv">site</span> <span class="nv">_</span> <span class="nv">pages</span><span class="p">]</span>
<span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nf">transform/transform-page</span> <span class="nb">root </span><span class="nv">site</span> <span class="nb">meta </span><span class="p">[]</span> <span class="p">(</span><span class="nf">structure-page</span> <span class="nv">site</span> <span class="p">(</span><span class="nf">org-&gt;html</span> <span class="nv">%</span><span class="p">)))</span> <span class="nv">pages</span><span class="p">))</span>
</pre></div>

</div>
</div>

<div id="outline-container-sec-7-0-1" class="outline-3">
<h3 id="sec-7-0-1">Render with Meta</h3>
<div class="outline-text-3" id="text-7-0-1">
<p>
Weaves the metadata of all pages with the current page.
Gives out a map of url with the pages weaved with meta data.
</p>


<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">nav-builder</span> <span class="p">[</span><span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">urls</span> <span class="nv">pages</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">nav</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="nb">partial </span><span class="nv">nav-element</span> <span class="nv">metadata</span><span class="p">)</span> <span class="nv">urls</span> <span class="nv">pages</span><span class="p">)]</span>
<span class="p">(</span><span class="nb">sort-by </span><span class="o">#</span><span class="p">(</span><span class="nf">vec</span> <span class="p">(</span><span class="nb">map </span><span class="nv">%</span> <span class="p">[</span><span class="ss">:title</span> <span class="ss">:subtitle</span><span class="p">]))</span> <span class="nv">nav</span><span class="p">)))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">full-render</span> <span class="p">[</span><span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">urls</span> <span class="nv">pages</span><span class="p">]</span>
<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">html-pages</span> <span class="p">(</span><span class="nb">map </span><span class="nv">org-&gt;html</span> <span class="nv">pages</span><span class="p">)</span>
      <span class="nv">sites</span> <span class="p">(</span><span class="nf">collect-vals</span> <span class="ss">:site</span> <span class="nv">config</span><span class="p">)</span>
      <span class="nv">pages</span> <span class="p">(</span><span class="nb">map </span><span class="nv">structure-page</span> <span class="nv">urls</span> <span class="nv">html-pages</span><span class="p">)</span>
      <span class="nv">nav</span> <span class="p">(</span><span class="nf">nav-builder</span> <span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">urls</span> <span class="nv">html-pages</span><span class="p">)]</span>
  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="nb">partial </span><span class="nv">transform/transform-page</span> <span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">sites</span> <span class="nv">nav</span><span class="p">)</span> <span class="nv">pages</span><span class="p">)))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">renderer</span> <span class="p">[</span><span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">mode</span><span class="p">]</span>
<span class="p">({</span><span class="ss">:quick</span> <span class="o">#</span><span class="p">(</span><span class="nf">quick-render</span> <span class="nb">root </span><span class="nv">site</span> <span class="nv">%1</span> <span class="nv">%2</span><span class="p">)</span>
  <span class="ss">:full</span> <span class="o">#</span><span class="p">(</span><span class="nf">full-render</span> <span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">%1</span> <span class="nv">%2</span><span class="p">)}</span> <span class="nv">mode</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-1">
<h1 id="sec-8">Build Site Map</h1>
<div class="outline-text-1" id="text-8">
<p>
Builds a website.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">build-site</span> <span class="p">[</span><span class="nb">root </span><span class="nv">render-mode</span> <span class="p">{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">source</span> <span class="nv">output</span><span class="p">]}]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">render-fn</span> <span class="p">(</span><span class="nf">renderer</span> <span class="nb">root </span><span class="nv">site</span> <span class="nv">metadata</span> <span class="nv">render-mode</span><span class="p">)</span>
  <span class="nv">assets</span> <span class="p">(</span><span class="nf">collect/collect-all</span> <span class="nv">site</span> <span class="nv">source</span> <span class="nv">render-fn</span><span class="p">)]</span>
<span class="nv">assets</span><span class="p">))</span>
</pre></div>

</div>

<p>
The progression is thus.
</p>

<p>
Collect -&gt; Transform -&gt; Render
</p>

<p>
The first two stages are done here.
</p>
</div>
</div>

<div id="outline-container-sec-9" class="outline-1">
<h1 id="sec-9">Collecting Files</h1>
<div class="outline-text-1" id="text-9">
<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defn </span><span class="nv">collect-files</span> <span class="p">[{</span><span class="ss">:keys</span> <span class="p">[</span><span class="nv">sites</span> <span class="nv">mode</span> <span class="nv">render-mode</span><span class="p">]</span> <span class="ss">:as</span> <span class="nv">config</span><span class="p">}]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">root </span><span class="p">(</span><span class="ss">:root</span> <span class="p">(</span><span class="nf">mode</span> <span class="nv">config</span><span class="p">))]</span>
    <span class="p">(</span><span class="nf">stasis/merge-page-sources</span> <span class="p">(</span><span class="nb">apply merge-with into </span><span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nf">build-site</span> <span class="nb">root </span><span class="nv">render-mode</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">sites</span><span class="p">)))))</span>
</pre></div>

</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-1">
<h1 id="sec-10">Finale</h1>
<div class="outline-text-1" id="text-10">
<p>
Servers or exports the pages. A multimethod to either render or export based on the configuration.
</p>

<div class="org-src-container">

<div class="highlight"><pre><span class="p">(</span><span class="kd">defmulti </span><span class="nv">render</span> <span class="ss">:mode</span><span class="p">)</span>

<span class="p">(</span><span class="kd">defmethod </span><span class="nv">render</span> <span class="ss">:serve</span> <span class="p">[</span><span class="nv">config</span><span class="p">]</span>
<span class="p">(</span><span class="nf">wrap-content-type</span> <span class="p">(</span><span class="nf">stasis/serve-pages</span> <span class="p">(</span><span class="nf">collect-files</span> <span class="nv">config</span><span class="p">))))</span>

<span class="p">(</span><span class="kd">defmethod </span><span class="nv">render</span> <span class="ss">:export</span> <span class="p">[</span><span class="nv">config</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">stasis/export-pages</span> <span class="p">(</span><span class="nf">collect-files</span> <span class="nv">config</span><span class="p">)</span> <span class="p">(</span><span class="ss">:output</span> <span class="nv">config</span><span class="p">)))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">app</span> <span class="p">(</span><span class="nf">render</span> <span class="nv">config</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">export-site-builder</span> <span class="p">[</span><span class="nv">site-map</span> <span class="nv">dir</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">stasis/export-pages</span> <span class="p">(</span><span class="nf">stasis/merge-page-sources</span> <span class="p">(</span><span class="nf">build-site</span> <span class="p">(</span><span class="ss">:root</span> <span class="p">(</span><span class="ss">:export</span> <span class="nv">config</span><span class="p">))</span> <span class="ss">:full</span> <span class="nv">site-map</span><span class="p">))</span> <span class="nv">dir</span><span class="p">))</span>


<span class="p">(</span><span class="kd">defn </span><span class="nv">exporter</span> <span class="p">[</span><span class="nv">site</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">site-map</span> 
	   <span class="p">({</span><span class="s">"code"</span> <span class="nv">code</span>
	     <span class="s">"dissertation"</span> <span class="nv">dissertation</span>
	     <span class="s">"design"</span> <span class="nv">design</span>
	     <span class="s">"help"</span> <span class="nv">help</span><span class="p">}</span>
	    <span class="nv">site</span><span class="p">)]</span>
    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">export-dir</span> <span class="p">(</span><span class="nf">back-one-directory</span> <span class="p">(</span><span class="nf">System/getProperty</span> <span class="s">"user.dir"</span><span class="p">))]</span>
    <span class="p">(</span><span class="nf">export-site-builder</span> <span class="nv">site-map</span> <span class="nv">export-dir</span><span class="p">))</span> <span class="p">(</span><span class="nb">println </span><span class="s">"No such site"</span><span class="p">)))</span>
</pre></div>

</div>
</div>
</div>
</section>

</article></section>
    </section>
  </body>

</html>